DP.define("comm::util io/ajax comm::mbox mvp/tpl event/live dom/dimension".split(" "),function(e,b){b("comm::util");var f=b("mvp/tpl"),g=b("event/live");b("dom/dimension");return e.Class({initialize:function(a,c){var d=this;this.node=a;this.options=c?c:{};this.tools=this.node.all("[data-id=head-tools]");this.tools.forEach(function(a){var c=$(a).all(">li");c.forEach(function(a){a=$(a);if(!a.hasClass("no-hover")&&!a.hasClass("tg-line")){var b=false;a.one("ul");a.on("mouseenter",function(){c.removeClass("hover");
$(this).addClass("hover");if($(this).hasClass("tg-tools-cart")&&b===false){var a=$(this);b=true;e.provide("comm::model/shopping-cart",function(c,b){(new b(a)).fetch(true,{},function(a){d.renderShoppingCart(a)})})}});a.on("mouseleave",function(){$(this).removeClass("hover")})}})})},renderShoppingCart:function(a){var c=a.shoppingcartDealGroupList?a.shoppingcartDealGroupList:[],b=this.node.one("[data-id=cart-list]"),a=f.parse('                    <ul class="tg-cart-list Fix">                        <?js if(it.list.length){ ?>                        <?js it.list.forEach(function(item){ ?>                            <li class="tg-cart-item">                                <div class="tg-cart-item-wrap">                                    <a target="_blank" title="@{item.title}" href="/deal/@{item.id}" class="tg-cart-img">                                        <img src="@{item.src}">                                    </a>                                    <a target="_blank" title="@{item.title}" href="/deal/@{item.id}" class="tg-cart-title <?js if(item.tip !== ""){ ?>light<?js } ?>">                                        @{item.title}                                    </a>                                    <span class="tg-cart-price">                                    ￥@{item.price}                                    </span>                                    <span class="tg-cart-status">                                    @{item.tip}                                    </span>                                </div>                            </li>                        <?js });?>                        <?js }else{ ?>                            <li class="tg-cart-empty">购物车为空</li>                        <?js } ?>                    </ul>                    <?js if(it.count){ ?>                        <div class="tg-cart-summary">                            <span>购物车里有@{it.count}个团购</span><a href="/shopping/cart" class="vc-btn vc-rbtn">查看购物车</a>                        </div>                    <?js } ?>                ')({list:c,
count:a.length});b.html(a)},renderUserStatus:function(a){var b=this.node.one("[data-type=login-status]"),d=a.data.userInfo;g.on(b,"click","a",function(b){b.prevent();a.clear();location.href=$(this).attr("href")});if(d&&d.userId){e.data("isLogin",true);b.html('<li class="no-hover">                    <span><a href="/account/usercenter">您好，'+d.userNickName+'</a></span>                        </li>                    <li class="tg-line icon"></li>                    <li class="no-hover">                        <span><a data-id="logout-link" href="/logout">退出</a></span>                    </li>                    <li class="tg-line icon"></li>')}else e.data("isLogin",
false)}})});
