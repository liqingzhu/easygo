DP.define(["comm::util","io/ajax","comm::mbox","comm::options-from-dataset"],function(b,j,r){var r=j("comm::util"),e=j("comm::options-from-dataset");return b.Class({initialize:function(c,a){var d=this;this.node=c;this.options=a?a:{};this.useExternalLogo=this.options.useExternalLogo;this.hideYellowBar=this.options.hideYellowBar;this.noSearchBox=this.options.noSearchBox;this.noHeadBar=this.options.noHeadBar;this.noNavBar=this.options.noNavBar;this.noBrowserUpgrade=this.options.noBrowserUpgrade;this.hideLamuAd=
this.options.hideLamuAd;if(!b.data("pageId")||1001!==b.data("pageId"))this.hideLamuAd=!0;this.loadWait=this.options.loadWait?this.options.loadWait:1E3;this.lazyProps=this.options.lazyProps&&this.options.lazyProps.length?this.options.lazyProps:["lazy-src","lazy-src-load"];this._trackBase();d.lazyProps.forEach(function(a){d._imageLazyLoad({property:a})});b.provide("comm::tg-headbar comm::tg-search comm::tg-nav comm::tg-logo comm::tg-footer comm::model/head-info".split(" "),function(a,t,f,c,h,i,u){var a=
d.node.one("#headbar"),g=d.node.one("[data-id=search-box]"),l=d.node.one("#nav-menu"),m=d.node.one("#logo"),n=d.node.one("#footer"),o,p,q;a.count()&&(o=new t(a,e(a.el(0))));g.count()&&(p=new f(g,e(g.el(0))));l.count()&&new c(l,e(l.el(0)));m.count()&&(q=new h(m,e(m.el(0))));n.count()&&new i(n,e(n.el(0)));(new u(d.node,{persistanceLevel:"page"})).fetch(false,{pageId:b.data("pageId"),searchQty:10,position:b.data("position")},function(){o&&o.renderUserStatus(this);p&&p.renderHotWords(this);q&&q.renderCurrentCity(this)})});
this.hideYellowBar||b.data("position")&&b.provide(["comm::tg-yellowbar","comm::model/message-bar"],function(a,c,f){var e=new c(d.node);(new f(d.node,{persistanceLevel:"session"})).fetch(!1,{position:b.data("position")||"other",dealGroupId:b.data("dealGroupId")||0,action:"showbar"},function(a){!a.messagebar||!a.messagebar.text?this.hideLamuAd||b.provide(["comm::tg-lamu","comm::model/activity-ad"],function(a,c,g){var a=new g(d.node,{name:"lamu-ad",persistanceLevel:"session"}),s=new c($("body")),c=[];
c.push({id:"pc_tuangou_toppull",city:b.data("cityID"),limit:1});a.fetch(false,{q:JSON.stringify(c)},function(){s.render(this,"pc_tuangou_toppull")})}):e.render(this)})});!this.noBrowserUpgrade&&7>=b.UA.ie&&b.provide(["comm::tg-browser-upgrade"],function(a,b){new b(d.node)})},_imageLazyLoad:function(c){var a={range:0};b.mix(a,c);r.lazyLoad(a)},_trackBase:function(){function c(a){var b,c,e,f=document.hippo,k={},h=function(a){return a in k?k[a]:a},i=0,a=a.replace(/#\(([^\(\)]*)\)/g,function(a,b){k["___hippo___"+
i]=b;return"___hippo___"+i++}),a=a.split("|");b=a[0].split(",");b.forEach(function(a){pageTracker._trackPageview(a)});if(a[1]&&1==a[1]&&(2==a.length?(c=b[0],e=1):3==a.length&&(a=a[2].split(","),2>a.length?(c=a[0].split("#")[0],e=h(a[0].split("#")[1])):(a.forEach(function(a){f.ext(a.split("#")[0],h(a.split("#")[1]))}),f.mv("",""))),f&&c))try{f.mv(c,e)}catch(j){}}b.data("dpTrack",c);b.DOM(document).on("click",function(a){var d,e;(d=a.target)&&(e=b.DOM(d).attr("data-hippo-track"))?c(e):(d=b.DOM(a.target).parent("a"))&&
(e=d.attr("data-hippo-track"))&&c(e)})}})});
