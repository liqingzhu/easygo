DP.define(["util/cookie"],function(d,s){var l="Hide",b=d.DOM,q=s("util/cookie"),o=[],r=!1;return{switcher:function(){this.trickOnload(function(){d.provide(["switch/core","fx/easing"],function(c,i,f){var g=0;b.all(".J_switch").forEach(function(c){var a=b(c),h=a.attr("id"),e,m,d;h||(h="J_switch_"+g++);c.id=h;c=(c=b("#"+h+" .J_wrap").children().el(0))&&c.nodeName.toLocaleLowerCase()||"li";e=(e=b("#"+h+" .J_ctrl").children().el(0))&&e.nodeName.toLocaleLowerCase()||"li";var k=new i;m={CSPre:"#"+h,containerCS:".J_wrap",
itemCS:c,triggerCS:".J_ctrl "+e,triggerOnCls:"on"};d=b.all("#"+h+" .J_wrap "+c);b("#"+h+" .J_before").count()&&(m.prevCS=".J_before")&&(m.itemSpace=b.all("#"+h+" .J_wrap "+c).get(0).css("width"));b("#"+h+" .J_after").count()&&(m.nextCS=".J_after");var n=function(a){a=d.get(a);a="img"===a.el(0).nodeName.toLowerCase()?a:a.one("img");a.attr("lazy_src")&&(a.attr("src",a.attr("lazy_src")),a.el(0).removeAttribute("lazy_src"))};if(a.hasClass("J_switch_carousel"))k.plugin("carousel","endless","autoPlay").on({beforeInit:function(){var a=
b("#"+h+" .J_before"),c=b("#"+h+" .J_after");b.all("#"+h+" .J_ctrl "+e).get(0).addClass("on");b("#"+h+" .J_wrap").css("width",d.count()*d.get(0).css("width"));a.count()&&c.count()&&b("#"+h).on({mouseenter:function(){a.removeClass("Hide");c.removeClass("Hide")},mouseleave:function(){a.addClass("Hide");c.addClass("Hide")}});n(0)},beforeSwitch:function(){n(this.expectIndex)}});else m.fx={duration:300,transition:f.linear},k.plugin("fade","autoPlay").on({beforeInit:function(){b.all("#"+h+" .wrap li").css("opacity",
0).addClass("Hide").get(0).css("opacity",1).removeClass("Hide");b("#"+h+" .J_ctrl li").addClass("on");n(0)},beforeSwitch:function(){d.removeClass(l);n(this.expectIndex)},completeSwitch:function(){d.forEach(function(a){a=b(a);1==a.css("opacity")?a.removeClass(l):a.addClass(l)})}});k.init(m)})})},500)},switcherFlexible:function(c){this.trickOnload(function(){d.provide(["switch/core","fx/easing"],function(i,f,g){var j=0;0>=b.all("."+c).count()||b.all("."+c).forEach(function(a){var c=b(a),e=c.attr("id"),
i,d,k;e||(e="J_switch_flexable_"+j++);a.id=e;a=(a=b("#"+e+" .J_wrap").children().el(0))&&a.nodeName.toLocaleLowerCase()||"li";i=(i=b("#"+e+" .J_ctrl").children().el(0))&&i.nodeName.toLocaleLowerCase()||"li";var n=new f;d={CSPre:"#"+e,containerCS:".J_wrap",itemCS:a,triggerCS:".J_ctrl "+i,triggerOnCls:"on"};k=b.all("#"+e+" .J_wrap "+a);b("#"+e+" .J_before").count()&&(d.prevCS=".J_before")&&(d.itemSpace=b.all("#"+e+" .J_wrap "+a).get(0).css("width"));b("#"+e+" .J_after").count()&&(d.nextCS=".J_after");
var p=function(a){a=k.get(a);a="img"===a.el(0).nodeName.toLowerCase()?a:a.one("img");a.attr("lazy_src")&&(a.attr("src",a.attr("lazy_src")),a.el(0).removeAttribute("lazy_src"))};if(c.hasClass("J_switch_carousel"))n.plugin("carousel","endless","autoPlay").on({beforeInit:function(){var a=b("#"+e+" .J_before"),c=b("#"+e+" .J_after");b.all("#"+e+" .J_ctrl "+i).get(0).addClass("on");b("#"+e+" .J_wrap").css("width",k.count()*k.get(0).css("width"));a.count()&&c.count()&&b("#"+e).on({mouseenter:function(){a.removeClass("Hide");
c.removeClass("Hide")},mouseleave:function(){a.addClass("Hide");c.addClass("Hide")}});p(0)},beforeSwitch:function(){p(this.expectIndex)}});else d.fx={duration:300,transition:g.linear},n.plugin("fade","autoPlay").on({beforeInit:function(){b.all("#"+e+" .wrap li").css("opacity",0).addClass("Hide").get(0).css("opacity",1).removeClass("Hide");b("#"+e+" .J_ctrl li").addClass("on");p(0)},beforeSwitch:function(){k.removeClass(l);p(this.expectIndex)},completeSwitch:function(){k.forEach(function(a){a=b(a);
1==a.css("opacity")?a.removeClass(l):a.addClass(l)})}});n.init(d)})})},500)},lazyLoad:function(c){d.provide(["dom/dimension"],function(i,f){var g=document.body,j=d.mix({range:0,elements:"img",container:window,fireScroll:!0,startPosition:0},c);j.property||(j.property="lazy-src");var a=j.container,h=j.property.split("-")[1],e=b.all(j.elements).el(),m=f.size(a).height,l=j.startPosition,k=function(){var c=a!=window&&a!=g?a:"",i=f.scroll(a).top;if(i>=l){e=e.filter(function(a){if(i+j.range+m>=f.offset(a,
c).top){var b=a.getAttribute(j.property);if(b){a.setAttribute(h,b);a.removeAttribute(j.property)}return false}return true},this);l=i}e.length||b(a).off("scroll",k)};b(a).on("scroll",k);j.fireScroll&&k()})},onceTip:function(c,b,f,g){function j(){q.read(b)?(c.addClass(l),a.onHide&&a.onHide()):(c.removeClass(l),a.onShow&&a.onShow())}var a=d.mix({trigger:null,triggerType:"mouseover",isDestroy:!1,onHide:null,onShow:null},g||{});if(c&&c.count())if(f.on("click",function(){a.isDestroy?c.destroy():c.addClass(l);
q.write(b,1,{duration:100});a.onHide&&a.onHide()}),a.trigger&&a.triggerType)a.trigger.on(a.triggerType,j);else j()},riskBox:function(){d.provide("comm::mbox",function(c,b){(new b({url:b.dialog("账号风险提示",'<p class="risk-tips">您的账号存在风险，已被网站保护起来，<br>请通过找回密码功能重置密码以恢复正常使用。</p>',[b.btn("找回密码",null,{click:function(){location.href="http://www.dianping.com/resetpassword"}})]).dialog})).open()})},celIcon:function(){},appIcon:function(){},trickOnload:function(c,i){var f=!1,d=function(){f||(f=!0,c())};b(window).on("load",
d);setTimeout(function(){d()},i||1E4)},windowScroll:{bind:function(c){d.isFunction(c)&&o.push(c);r||(b(window).on("scroll",function(c){o.forEach(function(b){b.call(window,c,b)})}),r=!0)},unbind:function(c){c=o.indexOf(c);-1!==c&&o.splice(c,1)}},runScript:function(c){d.DOM(c).all("script").forEach(function(c){b.create("script").inject(document.getElementsByTagName("head")[0]).el(0).text=c.innerHTML})},loadCss:function(c,b){var f=document.createElement("link");f.href=c;f.rel="stylesheet";var g=function(c,
a){if(document.createElement("css").attachEvent)c.attachEvent("onload",a);else{var b=!1,e=c.sheet;if(e)if(d.UA.webkit||d.UA.mozilla)b=!0;else try{e.cssRules&&(b=!0)}catch(f){"NS_ERROR_DOM_SECURITY_ERR"===f.name&&(b=!0)}b?setTimeout(function(){a.call(c)},0):setTimeout(function(){g(c,a)},10)}};b&&g(f,b);document.getElementsByTagName("head")[0].appendChild(f)},showDialogBox:function(c,b,f,g){d.provide("comm::mbox",function(d,a){g=new a({url:{dialog:a.dialog(c,a.tpl({title:b,icon:"",contentTop:"",contentBottom:""}),
[a.btn("取消","white",{click:function(){g.close()}}),f]).dialog},size:{x:402}});g.open()})},showMiniBox:function(c,b,f,g){d.provide("comm::mbox",function(j,a){f=new a({url:{dialog:a.dialog(c,b,[a.btn("确定",null,{click:function(){f.close()}})]).dialog}});f.on("close",function(){g&&d.isFunction(g)&&g()});f.open()})},ajaxRequest:function(c,b,f,g){d.provide("io/ajax",function(d,a){d.isFunction(f)||(f=function(){});(new a({url:c,method:!g||"get"!=g?"post":"get",data:b,async:!1})).on({success:f}).send()})},
trickByDimension:function(c,i){d.provide(["dom/dimension"],function(d,g){var j=g.size(window).height,a=0,h=!1,e=function(){var b=g.scroll(window).top;if(b>=a){if(b+100+j>=g.offset(c).top&&!h)return i&&i(),h=!0,!1;a=b;return!0}};b(window).on("scroll",e);e()})}}});
